<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Blue Archive イントロクイズ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="icon" href="https://bluearchive.jp/favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --blue-primary: #007bff;
      --blue-secondary: #00AEEF;
      --blue-dark: #0056b3;
      --red-primary: #dc3545;
      --red-dark: #c82333;
      --green-primary: #28a745;
      --green-dark: #218838;
      --grey-light: #f8f9fa;
      --grey-mid: #6c757d;
      --grey-dark: #343a40;
      --text-light: #fff;
      --text-dark: #212529;
      --border-color: #dee2e6;
      --bg-color: #f0f4f8;
      --card-bg: #ffffff;
      --shadow: 0 4px 6px rgba(0,0,0,0.1);
      --font-family: 'Noto Sans JP', sans-serif;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      background-color: var(--bg-color);
      color: var(--text-dark);
      overflow-x: hidden;
      /* 背景画像の設定 */
      background-image: url('bg_pc.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    @media (max-width: 768px) {
      body { background-image: url('bg_sp.png'); }
    }

    header {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 1em;
      text-align: center;
      border-bottom: 2px solid var(--blue-secondary);
      box-shadow: var(--shadow);
    }

    header h1 {
      margin: 0;
      color: var(--blue-primary);
      font-size: 1.5rem;
      font-weight: 700;
    }

    main {
      max-width: 800px;
      margin: 2em auto;
      padding: 0 1em;
      min-height: 70vh;
    }

    .screen {
      display: none;
      background-color: rgba(255, 255, 255, 0.95);
      padding: 2em;
      border-radius: 15px;
      box-shadow: var(--shadow);
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ロード画面のスタイル改善 */
    /* 変更開始 */
    #loading-screen {
      display: flex; /* 初期状態で表示 */
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: var(--bg-color);
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      transition: opacity 0.5s ease;
    }
    #loading-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    /* 変更終了 */

    .spinner {
      border: 8px solid var(--grey-light);
      border-top: 8px solid var(--blue-secondary);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin-bottom: 1em;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ボタン類 */
    button {
      padding: 0.8em 1.5em;
      font-size: 1rem;
      font-weight: 500;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: var(--font-family);
    }

    .btn-primary { background-color: var(--blue-primary); color: white; }
    .btn-primary:hover { background-color: var(--blue-dark); transform: scale(1.02); }
    .btn-secondary { background-color: var(--grey-mid); color: white; }

    /* メニュー画面 */
    #menu-screen h2 { text-align: center; margin-bottom: 1.5em; color: var(--grey-dark); }
    .menu-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 1em; }
    @media (max-width: 480px) { .menu-buttons { grid-template-columns: 1fr; } }
    .menu-buttons button { height: 80px; font-size: 1.1rem; }

    /* ゲーム画面 */
    #game-info { display: flex; justify-content: space-between; margin-bottom: 1em; font-weight: 700; color: var(--blue-dark); }
    #video-container { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 10px; overflow: hidden; margin-bottom: 1.5em; position: relative; }
    /* YouTubeプレイヤーを隠す（音声のみにする場合など）用 */
    #player-wrapper { width: 100%; height: 100%; }

    #choices { display: grid; grid-template-columns: 1fr 1fr; gap: 1em; margin-bottom: 1.5em; }
    @media (max-width: 480px) { #choices { grid-template-columns: 1fr; } }
    #choices button { background-color: white; border: 2px solid var(--blue-secondary); color: var(--blue-primary); min-height: 60px; }
    #choices button:hover { background-color: var(--blue-secondary); color: white; }
    #choices button.correct { background-color: var(--green-primary) !important; color: white !important; border-color: var(--green-dark) !important; }
    #choices button.incorrect { background-color: var(--red-primary) !important; color: white !important; border-color: var(--red-dark) !important; }

    #feedback { text-align: center; font-size: 1.5rem; font-weight: 700; margin-bottom: 1em; height: 1.5em; }
    .feedback-correct { color: var(--green-primary); }
    .feedback-incorrect { color: var(--red-primary); }

    /* モーダル/オーバーレイ */
    #result-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      z-index: 2000;
      color: white;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2em;
    }
    #result-overlay h2 { font-size: 2.5rem; color: var(--blue-secondary); margin-bottom: 0.5em; }
    #result-score { font-size: 2rem; margin-bottom: 1.5em; }

    /* アーカイブ */
    #archive-controls { display: flex; gap: 1em; margin-bottom: 2em; }
    #archive-search { flex: 1; padding: 0.8em; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem; }
    #archive-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1.5em; }
    .archive-item { background: white; border-radius: 10px; overflow: hidden; box-shadow: var(--shadow); cursor: pointer; transition: transform 0.2s; }
    .archive-item:hover { transform: translateY(-5px); }
    .archive-item img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
    .archive-item-info { padding: 0.8em; font-size: 0.9rem; }
    .archive-item-title { font-weight: 700; margin-bottom: 0.3em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* 設定・統計 */
    .settings-group, .stats-group { margin-bottom: 2em; padding-bottom: 1em; border-bottom: 1px solid var(--border-color); }
    .settings-group label { display: block; margin-bottom: 0.5em; font-weight: 700; }
    .settings-group select, .settings-group input { width: 100%; padding: 0.7em; border: 1px solid var(--border-color); border-radius: 5px; }

    /* スマホ対応の微調整 */
    @media (max-width: 600px) {
      main { margin: 1em auto; }
      .screen { padding: 1.2em; }
      #result-overlay h2 { font-size: 1.8rem; }
    }

    /* 特殊演出用 */
    .pulse { animation: pulse-animation 1s infinite; }
    @keyframes pulse-animation {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    #start-prompt {
        position: fixed;
        top:0; left:0; width:100%; height:100%;
        background: rgba(0,0,0,0.9);
        z-index: 10001;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #start-prompt-btn {
        padding: 2em 4em;
        font-size: 1.5em;
        background: var(--blue-primary);
        color: white;
        border-radius: 50px;
        box-shadow: 0 0 20px var(--blue-secondary);
    }
  </style>
</head>
<body>

  <div id="loading-screen">
    <div class="spinner"></div>
    <p id="loading-text">Loading Blue Archive Music...</p>
  </div>
  <header>
    <h1>Blue Archive イントロクイズ</h1>
  </header>

  <main>
    <div id="menu-screen" class="screen">
      <h2>メインメニュー</h2>
      <div class="menu-buttons">
        <button onclick="startGame(GAME_MODES.NORMAL)" class="btn-primary">ノーマル (10問)</button>
        <button onclick="startGame(GAME_MODES.TIMED)" class="btn-primary">タイムアタック (60秒)</button>
        <button onclick="startGame(GAME_MODES.ENDLESS)" class="btn-primary">エンドレス</button>
        <button onclick="startGame(GAME_MODES.COMPOSER_QUIZ)" class="btn-primary">作曲者クイズ</button>
        <button onclick="showArchive()" class="btn-secondary">サウンドアーカイブ</button>
        <button onclick="showStats()" class="btn-secondary">統計・実績</button>
        <button onclick="showSettings()" class="btn-secondary">設定</button>
      </div>
    </div>

    <div id="game-screen" class="screen">
        <div id="game-info">
          <div id="score-display">Score: 0</div>
          <div id="timer-display"></div>
          <div id="question-count">Question: 1/10</div>
        </div>
        
        <div id="video-container">
          <div id="player-wrapper">
            <div id="player"></div>
          </div>
          <div id="video-curtain" style="position:absolute; top:0; left:0; width:100%; height:100%; background:black; display:flex; justify-content:center; align-items:center; color:white; font-size:1.2rem; z-index:10;">
            ? ? ?
          </div>
        </div>

        <div id="feedback"></div>

        <div id="choices">
          </div>

        <div id="game-controls" style="text-align: center;">
            <div style="margin: 0.5em 0;">音量: <input type="range" id="volumeSlider" min="0" max="100" value="25" /></div>
          <div id="control-buttons">
            <button id="replayBtn">もう一度聞く</button>
            <button id="pauseBtn">再生</button>
            <button onclick="initGame()" style="background-color: var(--grey-dark);">ホームに戻る</button>
          </div>
        </div>
    </div>
    
    <div id="sound-archive-screen" class="screen">
        <h2>サウンドアーカイブ</h2>
        <div id="archive-controls">
            <input type="text" id="archive-search" placeholder="曲名、作曲者、関連キーワードで検索..." />
            <button id="archive-back-btn" style="padding: 0.5em 1em; font-size: 1.1em; background-color: var(--blue-primary); color: white;">戻る</button>
        </div>
        <div id="archive-grid"></div>
    </div>
    
    <div id="encyclopedia" class="screen"></div>
    <div id="settings-screen" class="screen"></div>
    <div id="stats-screen" class="screen"></div>
    <div id="start-prompt" style="display: none;"><button id="start-prompt-btn">タップして開始</button></div>
  </main>

  <footer>
    <div style="border: 1px solid var(--border-color); padding: 1em; background-color: #fff; border-radius: 12px; box-shadow: var(--shadow); margin-top: 2em; text-align: center; font-size: 0.85rem; color: var(--grey-mid);">
      &copy; 2024 Blue Archive イントロクイズ | Source: YouTube API
    </div>
  </footer>

  <div id="result-overlay">
    <h2 id="result-title">Finish!</h2>
    <div id="result-score">0 / 10</div>
    <div id="result-stats" style="margin-bottom: 2em;"></div>
    <button onclick="initGame()" class="btn-primary" style="padding: 1em 3em;">メニューに戻る</button>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="playlist.js"></script>
  <script src="main.js"></script>
</body>
</html>
